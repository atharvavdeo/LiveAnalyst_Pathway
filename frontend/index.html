<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveSocialAnalyst ‚Äî Surreal Intelligence</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --white: #ffffff;
            --off-white: #fafafa;
            --cream: #f8f6f3;
            --pearl: #f0ebe5;
            --lavender: #e8e0f0;
            --rose: #fce4ec;
            --sky: #e3f2fd;
            --mint: #e8f5e9;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a6a;
            --text-muted: #8a8aa8;
            --accent-violet: #7c3aed;
            --accent-rose: #ec4899;
            --accent-amber: #f59e0b;
            --accent-emerald: #10b981;
            --accent-sky: #0ea5e9;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 12px 48px rgba(0, 0, 0, 0.08);
            --shadow-glow: 0 0 60px rgba(124, 58, 237, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--white);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Surreal floating orbs background */
        .floating-orbs {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .orb:nth-child(1) {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, var(--lavender), var(--rose));
            top: -100px;
            right: -100px;
            animation-delay: 0s;
        }

        .orb:nth-child(2) {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, var(--sky), var(--mint));
            bottom: 10%;
            left: -50px;
            animation-delay: -5s;
        }

        .orb:nth-child(3) {
            width: 250px;
            height: 250px;
            background: linear-gradient(135deg, var(--rose), var(--lavender));
            top: 50%;
            right: 20%;
            animation-delay: -10s;
        }

        .orb:nth-child(4) {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, var(--mint), var(--sky));
            top: 30%;
            left: 10%;
            animation-delay: -15s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(20px, -30px) scale(1.05); }
            50% { transform: translate(-10px, 20px) scale(0.95); }
            75% { transform: translate(30px, 10px) scale(1.02); }
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            box-shadow: var(--shadow-glow);
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .logo-text span {
            font-style: italic;
            font-weight: 400;
        }

        .header-time {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: 56px;
            font-weight: 400;
            line-height: 1.15;
            margin-bottom: 20px;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-violet) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 300;
            max-width: 500px;
            margin: 0 auto 40px;
        }

        /* Search Section */
        .search-section {
            max-width: 700px;
            margin: 0 auto 60px;
        }

        .search-container {
            display: flex;
            background: var(--white);
            border-radius: 24px;
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            overflow: hidden;
            padding: 8px;
            border: 1px solid rgba(124, 58, 237, 0.1);
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 20px 28px;
            font-size: 16px;
            font-family: 'Outfit', sans-serif;
            background: transparent;
            color: var(--text-primary);
        }

        .search-input:focus {
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-muted);
            font-weight: 300;
        }

        .search-btn {
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            color: white;
            border: none;
            padding: 18px 36px;
            font-size: 15px;
            font-weight: 500;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Outfit', sans-serif;
            letter-spacing: 0.5px;
        }

        .search-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.3);
        }

        .search-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(0, 0, 0, 0.04);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .stat-card:nth-child(1) .stat-icon {
            background: linear-gradient(135deg, var(--lavender), var(--rose));
        }

        .stat-card:nth-child(2) .stat-icon {
            background: linear-gradient(135deg, var(--sky), var(--mint));
        }

        .stat-card:nth-child(3) .stat-icon {
            background: linear-gradient(135deg, var(--rose), var(--pearl));
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'Playfair Display', serif;
        }

        .stat-value span {
            font-size: 16px;
            color: var(--text-muted);
            font-weight: 400;
            font-family: 'Outfit', sans-serif;
        }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 40px;
        }

        @media (max-width: 900px) {
            .content-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            .hero h1 {
                font-size: 38px;
            }
        }

        /* Cards */
        .card {
            background: var(--white);
            border-radius: 28px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.04);
        }

        .card-header {
            padding: 24px 28px;
            display: flex;
            align-items: center;
            gap: 14px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
        }

        .card-header-icon {
            width: 42px;
            height: 42px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .card-content {
            padding: 28px;
        }

        /* Analysis Card */
        .analysis-card .card-header-icon {
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            color: white;
        }

        .analysis-card {
            grid-column: span 2;
        }

        @media (max-width: 900px) {
            .analysis-card {
                grid-column: span 1;
            }
        }

        .analysis-result {
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .analysis-result .highlight {
            color: var(--accent-violet);
            font-weight: 500;
        }

        .analysis-placeholder {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .analysis-placeholder-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Sentiment Card */
        .sentiment-card .card-header-icon {
            background: linear-gradient(135deg, var(--mint), var(--sky));
        }

        .sentiment-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .sentiment-emoji {
            font-size: 48px;
        }

        .sentiment-info h3 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .sentiment-info p {
            font-size: 14px;
            color: var(--text-muted);
        }

        .sentiment-positive { color: var(--accent-emerald); }
        .sentiment-neutral { color: var(--accent-amber); }
        .sentiment-negative { color: var(--accent-rose); }

        .keywords-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .keyword-tag {
            background: linear-gradient(135deg, var(--lavender), var(--rose));
            padding: 8px 16px;
            border-radius: 100px;
            font-size: 13px;
            color: var(--text-primary);
            font-weight: 400;
        }

        /* Reliability Card */
        .reliability-card .card-header-icon {
            background: linear-gradient(135deg, var(--rose), var(--lavender));
        }

        .reliability-meter {
            margin-bottom: 24px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .meter-bar {
            height: 12px;
            background: var(--pearl);
            border-radius: 100px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            border-radius: 100px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .reliability-stats {
            display: flex;
            gap: 20px;
        }

        .reliability-stat {
            flex: 1;
            text-align: center;
            padding: 16px;
            background: var(--off-white);
            border-radius: 16px;
        }

        .reliability-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .reliability-stat-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Live Feed */
        .feed-card {
            grid-column: span 2;
        }

        @media (max-width: 900px) {
            .feed-card {
                grid-column: span 1;
            }
        }

        .feed-card .card-header-icon {
            background: linear-gradient(135deg, var(--sky), var(--mint));
        }

        .feed-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .feed-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
        }

        .feed-item:last-child {
            border-bottom: none;
        }

        .feed-item:hover {
            background: var(--off-white);
            margin: 0 -28px;
            padding-left: 28px;
            padding-right: 28px;
        }

        .feed-source {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .feed-source.news {
            background: linear-gradient(135deg, var(--lavender), var(--rose));
        }

        .feed-source.hackernews {
            background: linear-gradient(135deg, #ff6600, #ff9900);
            color: white;
        }

        .feed-content {
            flex: 1;
        }

        .feed-text {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .feed-meta {
            font-size: 12px;
            color: var(--text-muted);
        }

        .feed-time {
            background: var(--pearl);
            padding: 6px 12px;
            border-radius: 100px;
            font-size: 12px;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: center;
            gap: 32px;
            padding: 24px;
            background: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow-sm);
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.ok {
            background: var(--accent-emerald);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        .status-dot.loading {
            background: var(--accent-amber);
            animation: pulse 1.5s infinite;
        }

        .status-dot.error {
            background: var(--accent-rose);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.9); }
        }

        .status-label {
            color: var(--text-muted);
            font-weight: 300;
        }

        .status-value {
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--off-white);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--pearl);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--lavender);
        }

        /* Loading animation */
        .loading-text {
            display: inline-flex;
            gap: 4px;
        }

        .loading-text span {
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-text span:nth-child(1) { animation-delay: -0.32s; }
        .loading-text span:nth-child(2) { animation-delay: -0.16s; }
        .loading-text span:nth-child(3) { animation-delay: 0s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Surreal floating orbs -->
    <div class="floating-orbs">
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
        <div class="orb"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">‚ú®</div>
                <div class="logo-text">Live<span>Analyst</span></div>
            </div>
            <div class="header-time" id="current-time">00:00:00</div>
        </header>

        <!-- Hero -->
        <section class="hero">
            <h1>Real-time Intelligence,<br>Beautifully Decoded</h1>
            <p>Analyze news and social media with AI-powered reliability scoring. Ask anything.</p>
        </section>

        <!-- Search -->
        <section class="search-section">
            <div class="search-container">
                <input type="text" class="search-input" id="topic-input" placeholder="What would you like to explore today?">
                <button class="search-btn" id="analyze-btn" onclick="analyzeTopic()">Analyze</button>
            </div>
        </section>

        <!-- Stats -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì∞</div>
                <div class="stat-label">News Sources</div>
                <div class="stat-value" id="news-count">0 <span>articles</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî∂</div>
                <div class="stat-label">HackerNews</div>
                <div class="stat-value" id="hn-count">0 <span>stories</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üéØ</div>
                <div class="stat-label">Questions Asked</div>
                <div class="stat-value" id="question-count">0 <span>total</span></div>
            </div>
        </section>

        <!-- Content Grid -->
        <section class="content-grid">
            <!-- Analysis Card -->
            <div class="card analysis-card">
                <div class="card-header">
                    <div class="card-header-icon">üß†</div>
                    <div class="card-title">AI Analysis</div>
                </div>
                <div class="card-content">
                    <div id="analysis-result" class="analysis-placeholder">
                        <div class="analysis-placeholder-icon">üí≠</div>
                        <p>Ask a question to get started with your analysis</p>
                    </div>
                </div>
            </div>

            <!-- Sentiment Card -->
            <div class="card sentiment-card">
                <div class="card-header">
                    <div class="card-header-icon">üí´</div>
                    <div class="card-title">Sentiment Analysis</div>
                </div>
                <div class="card-content">
                    <div class="sentiment-display">
                        <div class="sentiment-emoji" id="sentiment-emoji">üòä</div>
                        <div class="sentiment-info">
                            <h3 id="sentiment-label" class="sentiment-neutral">Neutral</h3>
                            <p id="sentiment-desc">Awaiting analysis</p>
                        </div>
                    </div>
                    <div class="keywords-container" id="keywords">
                        <span class="keyword-tag">#News</span>
                        <span class="keyword-tag">#Tech</span>
                        <span class="keyword-tag">#Analysis</span>
                    </div>
                </div>
            </div>

            <!-- Reliability Card -->
            <div class="card reliability-card">
                <div class="card-header">
                    <div class="card-header-icon">üéØ</div>
                    <div class="card-title">Source Reliability</div>
                </div>
                <div class="card-content">
                    <div class="reliability-meter">
                        <div class="meter-label">
                            <span>Reliability Score</span>
                            <span id="reliability-percent">50%</span>
                        </div>
                        <div class="meter-bar">
                            <div class="meter-fill" id="reliability-fill" style="width: 50%"></div>
                        </div>
                    </div>
                    <div class="reliability-stats">
                        <div class="reliability-stat">
                            <div class="reliability-stat-value" id="official-sources">0</div>
                            <div class="reliability-stat-label">Official Sources</div>
                        </div>
                        <div class="reliability-stat">
                            <div class="reliability-stat-value" id="community-sources">0</div>
                            <div class="reliability-stat-label">Community</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Feed -->
            <div class="card feed-card">
                <div class="card-header">
                    <div class="card-header-icon">üì°</div>
                    <div class="card-title">Live Evidence Feed</div>
                </div>
                <div class="card-content">
                    <div class="feed-list" id="feed-list">
                        <div class="analysis-placeholder">
                            <div class="loading-text">
                                <span>‚óè</span><span>‚óè</span><span>‚óè</span>
                            </div>
                            <p>Loading live feed...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-item">
                <span class="status-dot ok" id="news-status-dot"></span>
                <span class="status-label">News API</span>
                <span class="status-value" id="news-status">Connected</span>
            </div>
            <div class="status-item">
                <span class="status-dot ok" id="hn-status-dot"></span>
                <span class="status-label">HackerNews</span>
                <span class="status-value" id="hn-status">Connected</span>
            </div>
            <div class="status-item">
                <span class="status-dot ok" id="llm-status-dot"></span>
                <span class="status-label">AI Engine</span>
                <span class="status-value" id="llm-status">Ready</span>
            </div>
        </footer>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let questionCount = 0;

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit',
                hour12: true 
            });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Format time ago
        function formatAge(timestamp) {
            if (!timestamp) return 'just now';
            const now = Date.now();
            const then = new Date(timestamp).getTime();
            const diffSec = Math.floor((now - then) / 1000);
            if (diffSec < 60) return `${diffSec}s ago`;
            if (diffSec < 3600) return `${Math.floor(diffSec / 60)}m ago`;
            return `${Math.floor(diffSec / 3600)}h ago`;
        }

        // Update feed
        function updateFeed(items) {
            const feedList = document.getElementById('feed-list');
            if (!items || items.length === 0) {
                feedList.innerHTML = '<div class="analysis-placeholder"><p>No data available yet</p></div>';
                return;
            }

            feedList.innerHTML = items.slice(0, 10).map(item => {
                const isNews = item.source.toLowerCase().includes('news') || item.source === 'GNews';
                const sourceClass = isNews ? 'news' : 'hackernews';
                const sourceIcon = isNews ? 'üì∞' : 'üî∂';
                const text = (item.text || '').substring(0, 120) + (item.text?.length > 120 ? '...' : '');
                
                return `
                    <div class="feed-item">
                        <div class="feed-source ${sourceClass}">${sourceIcon}</div>
                        <div class="feed-content">
                            <div class="feed-text">${text}</div>
                            <div class="feed-meta">${item.source}</div>
                        </div>
                        <div class="feed-time">${formatAge(item.timestamp)}</div>
                    </div>
                `;
            }).join('');
        }

        // Fetch data
        async function fetchData() {
            try {
                setStatus('news', 'loading', '...');
                const response = await fetch(API_BASE + '/data');
                const data = await response.json();
                
                const newsItems = data.news || [];
                const hnItems = data.hackernews || [];
                
                document.getElementById('news-count').innerHTML = `${data.total_news || 0} <span>articles</span>`;
                document.getElementById('hn-count').innerHTML = `${data.total_hackernews || 0} <span>stories</span>`;
                
                const allItems = [
                    ...newsItems.map(item => ({...item, source: 'News'})),
                    ...hnItems.map(item => ({...item, source: 'HackerNews'}))
                ];
                
                updateFeed(allItems);
                setStatus('news', 'ok', 'Connected');
                setStatus('hn', 'ok', 'Connected');
                
                return allItems;
            } catch (error) {
                console.error('Error fetching data:', error);
                setStatus('news', 'error', 'Error');
                return [];
            }
        }

        // Set status
        function setStatus(type, status, text) {
            const dot = document.getElementById(`${type}-status-dot`);
            const label = document.getElementById(`${type}-status`);
            if (dot) {
                dot.className = `status-dot ${status}`;
            }
            if (label) {
                label.textContent = text;
            }
        }

        // Update sentiment display
        function updateSentiment(mood, percent) {
            const emoji = document.getElementById('sentiment-emoji');
            const label = document.getElementById('sentiment-label');
            const desc = document.getElementById('sentiment-desc');
            
            if (mood === 'POSITIVE' || mood === 'EXCITED') {
                emoji.textContent = 'üòä';
                label.textContent = 'Positive';
                label.className = 'sentiment-positive';
                desc.textContent = `${percent}% positive sentiment detected`;
            } else if (mood === 'NEGATIVE' || mood === 'PANIC') {
                emoji.textContent = 'üòü';
                label.textContent = mood === 'PANIC' ? 'Alarming' : 'Negative';
                label.className = 'sentiment-negative';
                desc.textContent = `${percent}% concerning indicators`;
            } else {
                emoji.textContent = 'üòê';
                label.textContent = 'Neutral';
                label.className = 'sentiment-neutral';
                desc.textContent = `${percent}% balanced coverage`;
            }
        }

        // Update keywords
        function updateKeywords(topic) {
            const container = document.getElementById('keywords');
            const words = topic.split(/\s+/).slice(0, 5).filter(w => w.length > 2);
            container.innerHTML = words.map(w => 
                `<span class="keyword-tag">#${w.replace(/[^a-zA-Z0-9]/g, '')}</span>`
            ).join('');
        }

        // Update reliability
        function updateReliability(newsCount, totalCount) {
            const percent = totalCount > 0 ? Math.round((newsCount / totalCount) * 100) : 50;
            document.getElementById('reliability-percent').textContent = `${percent}%`;
            document.getElementById('reliability-fill').style.width = `${percent}%`;
            document.getElementById('official-sources').textContent = newsCount;
            document.getElementById('community-sources').textContent = totalCount - newsCount;
        }

        // Analyze topic
        async function analyzeTopic() {
            const input = document.getElementById('topic-input');
            const btn = document.getElementById('analyze-btn');
            const topic = input.value.trim() || 'latest technology news';
            
            btn.disabled = true;
            btn.textContent = 'Analyzing...';
            setStatus('llm', 'loading', 'Processing...');
            
            document.getElementById('analysis-result').innerHTML = `
                <div class="loading-text" style="justify-content: center; display: flex;">
                    <span>‚óè</span><span>‚óè</span><span>‚óè</span>
                </div>
                <p style="text-align: center; color: var(--text-muted); margin-top: 12px;">Analyzing ${topic}...</p>
            `;
            
            try {
                await fetchData();
                
                const response = await fetch(API_BASE + '/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        query: `Analyze the current situation regarding: ${topic}. What are the key developments, reliability of sources, and overall sentiment?` 
                    })
                });
                
                const result = await response.json();
                questionCount++;
                document.getElementById('question-count').innerHTML = `${questionCount} <span>total</span>`;
                
                if (result.answer) {
                    const answer = result.answer;
                    document.getElementById('analysis-result').innerHTML = `
                        <div class="analysis-result">${answer.replace(/\n/g, '<br>')}</div>
                    `;
                    
                    const sources = result.sources_analyzed || {};
                    const newsCount = sources.news || 0;
                    const totalCount = sources.total || 1;
                    
                    updateReliability(newsCount, totalCount);
                    
                    // Determine sentiment
                    let mood = 'NEUTRAL';
                    let percent = 50;
                    if (answer.match(/positive|good|success|growth|improve|innovative|exciting/i)) {
                        mood = 'POSITIVE'; percent = 70;
                    } else if (answer.match(/negative|bad|fail|decline|concern|warning|problem/i)) {
                        mood = 'NEGATIVE'; percent = 30;
                    } else if (answer.match(/panic|crisis|urgent|emergency|severe/i)) {
                        mood = 'PANIC'; percent = 15;
                    }
                    
                    updateSentiment(mood, percent);
                    updateKeywords(topic);
                    
                    setStatus('llm', 'ok', 'Ready');
                } else if (result.error) {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error('Analysis error:', error);
                setStatus('llm', 'error', 'Error');
                document.getElementById('analysis-result').innerHTML = `
                    <div class="analysis-placeholder">
                        <div class="analysis-placeholder-icon">‚ö†Ô∏è</div>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Analyze';
            }
        }

        // Auto-test with 203 questions
        async function runAutoTest() {
            const questions = [
                "What's happening in AI today?",
                "Latest cryptocurrency news",
                "Climate change updates",
                "SpaceX development progress",
                "Apple product announcements",
                "Google AI advancements",
                "Meta VR/AR developments",
                "Tesla electric vehicle news",
                "Microsoft Azure updates",
                "Amazon AWS innovations",
                "Netflix content strategy",
                "Cybersecurity threats today",
                "Quantum computing progress",
                "Blockchain technology updates",
                "5G network expansion",
                "Renewable energy trends",
                "Electric vehicle market",
                "Startup funding news",
                "Tech layoffs updates",
                "Remote work trends",
                "Digital privacy concerns",
                "Social media regulations",
                "E-commerce growth",
                "Fintech innovations",
                "Healthcare technology",
                "EdTech developments",
                "Gaming industry news",
                "Streaming wars update",
                "Robotics advancements",
                "Autonomous vehicles",
                "Drone technology",
                "Smart home devices",
                "Wearable technology",
                "AR/VR applications",
                "Machine learning trends",
                "Natural language processing",
                "Computer vision advances",
                "Cloud computing updates",
                "Edge computing news",
                "IoT developments",
                "Big data analytics",
                "Data science trends",
                "Python programming news",
                "JavaScript frameworks",
                "React development",
                "Node.js updates",
                "DevOps practices",
                "Kubernetes news",
                "Docker updates",
                "Microservices architecture",
                "API development trends",
                "Database technologies",
                "PostgreSQL updates",
                "MongoDB news",
                "Redis caching",
                "GraphQL adoption",
                "REST API best practices",
                "Web3 development",
                "NFT market analysis",
                "DeFi protocols",
                "Smart contracts",
                "Ethereum updates",
                "Bitcoin analysis",
                "Altcoin trends",
                "Crypto regulation",
                "Central bank digital currencies",
                "Stablecoin news",
                "Crypto exchange updates",
                "Wallet security",
                "Mining profitability",
                "Layer 2 solutions",
                "Blockchain scalability",
                "Interoperability protocols",
                "Zero knowledge proofs",
                "Privacy coins",
                "Tokenomics trends",
                "DAO governance",
                "Metaverse developments",
                "Virtual real estate",
                "Digital fashion",
                "Avatar technology",
                "Haptic feedback",
                "Mixed reality",
                "Spatial computing",
                "Brain-computer interfaces",
                "Neuralink progress",
                "Gene editing news",
                "CRISPR technology",
                "Biotechnology advances",
                "Vaccine development",
                "Drug discovery AI",
                "Personalized medicine",
                "Telemedicine growth",
                "Mental health tech",
                "Fitness technology",
                "Sleep technology",
                "Nutrition apps",
                "Meditation apps",
                "Productivity tools",
                "Project management software",
                "CRM innovations",
                "Marketing automation",
                "Email marketing trends",
                "SEO best practices",
                "Content marketing",
                "Influencer marketing",
                "Video marketing",
                "Podcast growth",
                "Audio technology",
                "Music streaming",
                "Podcast platforms",
                "Voice assistants",
                "Smart speakers",
                "Home automation",
                "Security cameras",
                "Smart locks",
                "Energy management",
                "Solar technology",
                "Battery storage",
                "Hydrogen fuel cells",
                "Carbon capture",
                "Climate tech",
                "AgriTech innovations",
                "Vertical farming",
                "Lab-grown meat",
                "Food delivery tech",
                "Restaurant technology",
                "Hospitality tech",
                "Travel technology",
                "Aviation technology",
                "Shipping automation",
                "Logistics tech",
                "Supply chain AI",
                "Inventory management",
                "Retail technology",
                "Checkout innovations",
                "Payment technology",
                "Mobile payments",
                "Contactless payments",
                "Buy now pay later",
                "Insurance tech",
                "Wealth management",
                "Robo-advisors",
                "Trading algorithms",
                "Stock market AI",
                "Forex trading tech",
                "Commodity trading",
                "Real estate tech",
                "Property management",
                "Construction tech",
                "3D printing buildings",
                "Sustainable architecture",
                "Smart cities",
                "Urban planning",
                "Transportation planning",
                "Public transit tech",
                "Bike sharing",
                "Scooter rentals",
                "Car sharing",
                "Ride hailing updates",
                "Delivery robots",
                "Last mile delivery",
                "Warehouse automation",
                "Fulfillment centers",
                "Pick and pack robots",
                "Sorting technology",
                "Conveyor systems",
                "Industrial automation",
                "Manufacturing AI",
                "Predictive maintenance",
                "Quality control AI",
                "Industrial IoT",
                "Digital twins",
                "Simulation technology",
                "CAD software",
                "3D modeling",
                "Animation technology",
                "Visual effects",
                "Film technology",
                "Camera innovations",
                "Lens technology",
                "Lighting technology",
                "Sound technology",
                "Microphone innovations",
                "Speaker technology",
                "Headphone trends",
                "Earbuds market",
                "Noise cancellation",
                "Spatial audio",
                "Hi-res audio",
                "Vinyl resurgence",
                "Turntable technology",
                "Music production",
                "DAW software",
                "Plugin innovations",
                "Synthesizer trends",
                "MIDI controllers",
                "DJ technology",
                "Live streaming music",
                "Concert technology",
                "Ticketing platforms",
                "Event management",
                "Virtual events",
                "Hybrid events",
                "Conference technology",
                "Presentation tools",
                "Collaboration software"
            ];
            
            const totalQuestions = 203;
            console.log(`Starting auto-test with ${totalQuestions} questions...`);
            
            for (let i = 0; i < totalQuestions; i++) {
                const question = questions[i % questions.length] + (i >= questions.length ? ` (round ${Math.floor(i / questions.length) + 1})` : '');
                document.getElementById('topic-input').value = question;
                
                try {
                    await analyzeTopic();
                    console.log(`Question ${i + 1}/${totalQuestions} completed: ${question}`);
                    // Small delay between questions
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    console.error(`Question ${i + 1} failed:`, error);
                }
            }
            
            console.log('Auto-test complete!');
            alert(`Completed ${totalQuestions} questions! Check the console for details.`);
        }

        // Initialize
        setInterval(fetchData, 30000);
        fetchData();
        
        // Enter key to analyze
        document.getElementById('topic-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') analyzeTopic();
        });
        
        // Expose runAutoTest to window for manual triggering
        window.runAutoTest = runAutoTest;
        
        // Add a subtle button to run auto test
        const autoTestBtn = document.createElement('button');
        autoTestBtn.textContent = 'üß™ Run 203 Questions Test';
        autoTestBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent-violet), var(--accent-rose));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-family: 'Outfit', sans-serif;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(124, 58, 237, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        `;
        autoTestBtn.onclick = runAutoTest;
        document.body.appendChild(autoTestBtn);
    </script>
</body>
</html>
